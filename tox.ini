[tox]
envlist = 
    py{310,311}-duckdb{102,103}-pyarrow{13,14}
    py311-duckdb103-pyarrow14-streamlit
    lint
    security

[testenv]
deps =
    duckdb102: duckdb==0.10.2
    duckdb103: duckdb==0.10.3
    pyarrow13: pyarrow==13
    pyarrow14: pyarrow==14
    streamlit: streamlit
    pytest
    pytest-cov
    -r requirements.txt

commands =
    streamlit: pytest -m "not slow" --cov=src --cov-report=term-missing
    !streamlit: pytest -m "not streamlit and not slow" --cov=src --cov-report=term-missing

[testenv:lint]
deps =
    ruff
    mypy
    black
    isort

commands =
    ruff check src/ tests/
    mypy src/ --ignore-missing-imports
    black --check src/ tests/
    isort --check-only src/ tests/

[testenv:security]
deps =
    bandit
    safety

commands =
    bandit -r src/
    safety check

[testenv:format]
deps =
    black
    isort

commands =
    black src/ tests/
    isort src/ tests/
